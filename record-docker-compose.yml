version: "3.7"

networks:
  public:
    name: public
    external: true

services:
    redis:
        image:
            redis
        ports:
            - 0.0.0.0:6379:6379
        networks:
            - public

    influxdb:
        image: influxdb
        environment:
            - INFLUXDB_ADMIN_USER=jose
            - INFLUXDB_ADMIN_PASSWORD=/run/secrets/INFLUXDB_ADMIN_PASSWORD
        secrets:
            - INFLUXDB_ADMIN_PASSWORD
        ports:
            - 0.0.0.0:28953:8086
        volumes:
            - "./influxdb.conf:/etc/influxdb/influxdb.conf"
            - "${HOME}/influxdb:/var/lib/influxdb"

        command: influxd -config /etc/influxdb/influxdb.conf
        networks:
            - public

secrets:
    INFLUXDB_ADMIN_PASSWORD:
        external: true
